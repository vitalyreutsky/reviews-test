(()=>{"use strict";function e(e){e&&e.classList.add("loading")}function t(e){e&&e.classList.remove("loading")}window.addEventListener("DOMContentLoaded",(function(){const r=document.querySelector(".reviews");if(r){const o=r.querySelector(".form"),s=r.querySelector(".reviews__items"),n=r.querySelector(".reviews__cards"),i=r.querySelector(".reviews__filter"),a=r.querySelector(".form__result"),c=a.querySelector(".form__result-text");async function d(e){const r=window.location.origin;try{const d=await fetch(`${r}/wp-admin/admin-ajax.php`,{method:"post",headers:new Headers({"Content-Type":"application/x-www-form-urlencoded"}),body:`action=set_reviews&data=${e}`});if(!d.ok)throw new Error(`HTTP error! status: ${d.status}`);let l=await d.json();l&&(t(o),a.classList.remove("is-hidden"),c.textContent=l.data_name,n.innerHTML=l.result+n.innerHTML,n.children.length>1&&i.classList.remove("is-hidden"),s.classList.remove("is-hidden"),c.textContent=l.moderation_text,setTimeout((()=>{a.classList.add("is-hidden")}),2e3))}catch(e){console.error("Error:",e),t(o),a.classList.remove("is-hidden"),c.textContent="Ошибка при отправке отзыва. Пожалуйста, попробуйте еще раз.",setTimeout((()=>{a.classList.add("is-hidden")}),2e3)}}const l=t=>{t.preventDefault();const r=t.target.querySelectorAll(".field"),o={name:null,message:null};let s=!0;r.forEach((e=>{const t=e.value.trim();t?/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/i.test(t)?(e.classList.add("error"),s=!1):(e.classList.remove("error"),o[e.name]=t):(e.classList.add("error"),s=!1)})),s?(e(t.target),d(JSON.stringify(o)),t.target.reset()):console.log("error: form validation failed")};o.addEventListener("submit",(e=>{l(e)}))}})),window.addEventListener("DOMContentLoaded",(()=>{const r=document.querySelectorAll(".sort-btn"),o=document.querySelector(".reviews__cards");r.forEach((s=>{s.addEventListener("click",(n=>{r.forEach((e=>{e.classList.remove("active")})),s.classList.add("active");const i=s.getAttribute("value");e(o.parentElement),async function(e){const r=window.location.origin,s=document.querySelector(".hide-field").getAttribute("value");try{const n=await fetch(`${r}/wp-admin/admin-ajax.php`,{method:"POST",headers:new Headers({"Content-Type":"application/x-www-form-urlencoded"}),body:`action=sort_reviews&date=${e}&post_id=${s}`});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const i=await n.json();i?(t(o.parentElement),o.innerHTML=i.result):(console.error("No results received"),t(o.parentElement))}catch(e){console.error("Error:",e),t(o.parentElement)}}(i)}))}))}))})();