(()=>{"use strict";function e(e){e&&e.classList.add("loading")}function t(e){e&&e.classList.remove("loading")}window.addEventListener("DOMContentLoaded",(function(){const r=document.querySelector(".reviews");if(r){const o=r.querySelector(".form"),n=r.querySelector(".reviews__cards"),s=r.querySelector(".reviews__filter"),i=r.querySelector(".form__result"),a=i.querySelector(".form__result-text");async function c(e){const r=window.location.origin;try{const c=await fetch(`${r}/wp-admin/admin-ajax.php`,{method:"post",headers:new Headers({"Content-Type":"application/x-www-form-urlencoded"}),body:`action=set_reviews&data=${e}`});if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);let d=await c.json();t(o),i.classList.remove("is-hidden"),a.textContent=d.moderation_text,n.children.length>1&&s.classList.remove("is-hidden"),setTimeout((()=>{i.classList.add("is-hidden")}),2e3)}catch(e){console.error("Error:",e),t(o),i.classList.remove("is-hidden"),a.textContent="Ошибка при отправке отзыва. Пожалуйста, попробуйте еще раз.",setTimeout((()=>{i.classList.add("is-hidden")}),2e3)}}const d=t=>{t.preventDefault();const r=t.target.querySelectorAll(".field"),o={name:null,message:null};let n=!0;r.forEach((e=>{const t=e.value.trim();""===t?(e.classList.add("error"),n=!1):(e.classList.remove("error"),o[e.name]=t)})),n?(e(t.target),c(JSON.stringify(o)),t.target.reset()):console.log("error: form validation failed")};o.addEventListener("submit",(e=>{d(e)}))}})),window.addEventListener("DOMContentLoaded",(()=>{const r=document.querySelectorAll(".sort-btn"),o=document.querySelector(".reviews__cards");r.forEach((n=>{n.addEventListener("click",(s=>{r.forEach((e=>{e.classList.remove("active")})),n.classList.add("active");const i=n.getAttribute("value");e(o.parentElement),async function(e){const r=window.location.origin,n=document.querySelector(".hide-field").getAttribute("value");try{const s=await fetch(`${r}/wp-admin/admin-ajax.php`,{method:"POST",headers:new Headers({"Content-Type":"application/x-www-form-urlencoded"}),body:`action=sort_reviews&date=${e}&post_id=${n}`});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const i=await s.json();i?(t(o.parentElement),o.innerHTML=i.result):(console.error("No results received"),t(o.parentElement))}catch(e){console.error("Error:",e),t(o.parentElement)}}(i)}))}))}))})();